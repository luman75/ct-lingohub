#!/usr/bin/env coffee
linghub = require "./lingohub"
packagejson = require "./package.json"
ArgumentParser = require('argparse').ArgumentParser

parser = new ArgumentParser({ version: packagejson.version, addHelp: true, description: packagejson.description })
subparsers = parser.addSubparsers( {title: "Commands to be used with #{packagejson.name}", dest: 'command'} )

login = subparsers.addParser('login', {addHelp: true, description: "Login to lingohub and stores login token in ~/.ct-import.auth file" })
login.addArgument( ['-t', '--token'],  { action: 'store', required: true, help: 'token to be used for accessing Lingogub API' } )
login.addArgument( ['-a', '--account'],  { action: 'store', required: true, help: 'account name to be used together with TOKEN' } )

logout = subparsers.addParser('logout', {addHelp: true, description: "Logout from lingohub. It removes login token from ~/.ct-import.auth file" })

projects = subparsers.addParser('projects', {addHelp: true, description: "List all projects registered in the system" })
projects.addArgument( ['-t', '--token'],    { action: 'store', required: false, help: 'token to be used for accessing Lingogub API' } )
projects.addArgument( ['-a', '--account'],  { action: 'store', required: false, help: 'account name to be used together with TOKEN' } )




resultPrinter = (err, msg) ->
  if err
    console.error "Error occurred"
    console.error(err)
  else
    console.log("Login successfuly. Your credentials are saved in ~/.ct-import.auth")




options = parser.parseArgs();

switch options.command
  when "login"
    linghub.login options.account, options.token, (err) ->
        resultPrinter(err, "Login successfuly. Your credentials are saved in ~/.ct-import.auth")

  when "logout"
    linghub.logout (err) ->
        resultPrinter(err, "Logged out successfuly")

  when "projects"
    linghub.projects options, (err, data) ->
      resultPrinter(err, "List of projects #{JSON.stringify(data)}")

  else
    console.log("else")

